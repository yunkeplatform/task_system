var UploadImage={fileInput:null,dragDrop:null,upButton:null,url:"",fileFilter:[],filter:function(e){return e},onSelect:function(){},onDelete:function(){},onDragOver:function(){},onDragLeave:function(){},onProgress:function(){},onSuccess:function(){},onFailure:function(){},onComplete:function(){},funDragHover:function(e){return e.stopPropagation(),e.preventDefault(),this["dragover"===e.type?"onDragOver":"onDragLeave"].call(e.target),this},funGetFiles:function(e){this.funDragHover(e);var t=e.target.files||e.dataTransfer.files;return this.fileFilter=this.fileFilter.concat(this.filter(t)),this.funDealFiles(),this},funDealFiles:function(){for(var e,t=0;e=this.fileFilter[t];t++)e.index=t;return this.onSelect(this.fileFilter),this},funDeleteFile:function(e){for(var t,n=[],i=0;t=this.fileFilter[i];i++)t!=e?n.push(t):this.onDelete(e);return this.fileFilter=n,this},funUploadFile:function(){var e=this;if(!(location.host.indexOf("sitepointstatic")>=0))for(var t,n=0;t=this.fileFilter[n];n++)!function(t){var n=new XMLHttpRequest;n.upload&&(n.upload.addEventListener("progress",function(n){e.onProgress(t,n.loaded,n.total)},!1),n.onreadystatechange=function(i){4==n.readyState&&(200==n.status?(e.onSuccess(t,n.responseText),e.funDeleteFile(t),e.fileFilter.length||e.onComplete()):e.onFailure(t,n.responseText))},n.open("POST",e.url,!0),n.setRequestHeader("X_FILENAME",encodeURIComponent(t.name)),n.send(t))}(t)},init:function(){var e=this;this.dragDrop&&(this.dragDrop.addEventListener("dragover",function(t){e.funDragHover(t)},!1),this.dragDrop.addEventListener("dragleave",function(t){e.funDragHover(t)},!1),this.dragDrop.addEventListener("drop",function(t){e.funGetFiles(t)},!1)),this.fileInput&&this.fileInput.addEventListener("change",function(t){e.funGetFiles(t)},!1),this.upButton&&this.upButton.addEventListener("click",function(t){e.funUploadFile(t)},!1)}};